Data Grooming
=================================================
This report  offers several technical explanations about the properties of dataset and how to work with it during modeling and graphing.
s
<!--  Set the working directory to the repository's base directory; this assumes the report is nested inside of only one directory.-->
```{r, echo=F, message=F} 
opts_knit$set(root.dir='../../')  #Don't combine this call with any other chunk -especially one that uses file paths.

```


<!-- Set the report-wide options, and point to the external code file. -->
```{r set_options, echo=F, message=F}
require(knitr)
# getwd()
opts_chunk$set(
  results='show', 
  message = TRUE,
  comment = NA, 
  tidy = FALSE,
  fig.height = 4.8, 
  fig.width = 6.5, 
  out.width = "550px",
  fig.path = 'figure_rmd/',     
  dev = "png",
#   fig.path = 'figure_pdf/',     
#   dev = "pdf",ssssss
  dpi = 400
)
echoChunks <- FALSE
options(width=120) #So the output is 50% wider than the default.
read_chunk("./Models/Descriptives/Descriptives.R") # the file to which knitr calls for the chunks
```

```{r DeclareGlobals, echo=echoChunks, message=FALSE}
```

```{r LoadPackages, echo=echoChunks, message=F}
```

```{r echo=echoChunks, message=FALSE}
dsL<-readRDS("./Data/Derived/dsL.rds")
```


### Data In
Initial point of departure - the [databox](http://statcanvas.net/thesis/databox/) of the selected sample, described in the [Methods](http://statcanvas.net/thesis/III_methods/03_Methods.htm) chapter and located in the [Results](http://statcanvas.net/thesis/IV_Results/04_Results.htm) chapter of the dissertation.
<img link src="./figure_rmd/3_Methods_Figure_3_2.png" alt="Databox slice" style="width:900px;"/>
This [databox](http://statcanvas.net/thesis/databox/) corresponds to the dataset **dsL** the screenshot of which is given below
<img link src="./figure_rmd/3_Methods_Figure_3_3.png" alt="View of dsL" style="width:1200px;"/> 
We load the dataset **dsL**, which was obtained by the report [Derive_dsL_from_Extract](https://github.com/andkov/Longitudinal_Models_of_Religiosity_NLSY97/blob/master/Data/Derive_dsL_from_Extract.md) and saved as a **.rds** dataset file, native to R.




### Organizing the metrics 
Review of the item reference [cards](http://statcanvas.net/thesis/databox/) shows that initially, all items were recorded on some discrete scale, either counting occasions or assigning an intiger to a category of response. However, in the original dataset they are recorded as either a numerical value or an intiger. 
Estimations packages such as lm4 or graphing   such as ggplot treat factor data type differntly from integers or numbers. It's convenient to have quick access to both. So instead of replacing the initial variables with factors and decode them back later when we need access to raw values, we'll create parallel set of variables in the original dataset. The script [LabelingFactorLevels.R](https://github.com/andkov/Longitudinal_Models_of_Religiosity_NLSY97/blob/master/Manipulation/LabelingFactorLevels.R), part of the dynamic report [Derive_dsL_from_Extract.md](https://github.com/andkov/Longitudinal_Models_of_Religiosity_NLSY97/blob/master/Data/Derive_dsL_from_Extract.md) augments  **dsL** with a copy variables as factors,  mannually assigned factor labels. Each variable in the dataset **dsL** contains a twin - a labeled factor - marked by suffix "F" attached to end of the variable name. 
```{r}
str(dsL)
```
This give a certain flexibiity to assemble needed dataset quickly and have access to factor labels.
```{r}
selectCols<-c("year","id","byear","attend","attendF") # type in variable name
ds<-dsLF[,selectCols] # select all rows and only columns listed in the object selectCols
print(ds[ds$id==1,])  # print all availible data for respondent with ID number of 1
```
Having quick access to factor labels will come especially handy during graph production.






### Selecting working datasets
We don't need all the variables at the moment, so let's select only those we need to describe how respondents' church attendance was changing across time. Let's start with picking person's id, wave of measurement, and church attendance
```{r}
print (dsL[dsL$id==1,c("id","year","attend")])
```
Now, let's add to the selection person's year of birth and age in months at the time of the interview
```{r, echo=TRUE}
selectCols<-c("year","id","byear","agemon","attend") # type in variable name
ds<-dsL[,selectCols] # select all rows and only columns listed in the object selectCols
print(ds[ds$id==1,])  # print all availible data for respondent with ID number of 1
```
Generally we can select any desired dataset by formula **dataset**[  _condition for rows_  ,  _condition for columns_  ]
```{r}
ds<-dsL[dsL$year %in% c(2000:2011),c('id',"byear","year","attendF","ageyearF","agemon")]
print(ds[ds$id==1,]) 
```



```{r,echo=FALSE}
# print (dsL[dsL$id==1,c("id","year","attend")]) # print [ rows, columns/variables]

```


```{r}
source(file.path(pathDir,"UtilityScripts/produceMDandHTML.R"))

```

