{
    "contents" : "###################################\n### Reproducible Research\n###################################\n# Importing the raw data from the NLS Investigator download object\n###################################\n# Clear memory from previous runs\n# base::rm(list=base::ls(all=TRUE))\n\n#####################################\n## @knitr LoadData\n\n###################################\n# Load the necessary packages.\nbase::require(base)\nbase::require(knitr)\nbase::require(markdown)\nbase::require(testit)\nbase::require(plyr)\nbase::require(reshape2)\n\n  ### Import the data ##\npathDir<-file.path(getwd()) # define path for project root directory\n\n# Links to the data source\ntagset # tagset is defined in \"Reproduce.R\"\ntagset<-c(\"NLSY97_Religiosity_20042014\") #\"Database_ResponseOfInterest_DateOfDownload\"\npathDataFolder<-file.path(getwd(),paste0(\"Documentation/data/\",tagset))\npathDataSource<-file.path(pathDataFolder,paste0(tagset,\".csv\")) \npathDataSourceLabels<-file.path(pathDataFolder,paste0(tagset,\".dct\"))  \n# reading in the data\ndsSource<-read.csv(pathDataSource,header=TRUE, skip=0,sep=\",\")\nvarOrig<-ncol(dsSource) # Original number of variables in the NLS download\ndsSource[\"T6650500\"]<-NULL # Remove version number for cleaner dataset\nvarnames<-names(dsSource)\n\n# NLSY97 variable id are linked to the descriptive label in the file dictionary file \"NLSY97_Religiosity_20042014.dtc\"\ndsSourceLabels<-read.csv(pathDataSourceLabels,header=TRUE, skip=0,nrow=varOrig, sep=\"\")\ndsSourceLabels$X.<-NULL\ndsSourceLabels<-rename(dsSourceLabels,replace=c(\"infile\"=\"RNUM\",\"dictionary\"=\"VARIABLE_TITLE\")) # rename to match NLS Web Investigator format\ndsSourceLabels<-dsSourceLabels[dsSourceLabels$RNUM!=\"T6650500\",] # remove version number from list of variables\ndsSourceLabels<-arrange(dsSourceLabels,VARIABLE_TITLE) # sort by Variable Title\nwrite.table(dsSourceLabels, \"./Documentation/data/dsSourceLabels.csv\", sep=\",\")\n\n############################\n## @knitr TweakData\n\n# Using renaming template \"NLSY97_Religiosity_20042014.xlsx\" located in \"Documentation\\data\" folder\n# rename the native variable names of NLSY97 (left) into custom chosen names for programming convenience (right)\n\ndsSource<-rename(dsSource, c(\n  \"R0323900\"=\"famrel_1997\",\n  \"R2165200\"=\"famrel_1998\",\n  \"R3483100\"=\"famrel_1999\",\n  \"R4881300\"=\"famrel_2000\",\n  \"S2977900\"=\"internet_2003\",\n  \"S4676700\"=\"internet_2004\",\n  \"S6308900\"=\"internet_2005\",\n  \"S8329800\"=\"internet_2006\",\n  \"T0737600\"=\"internet_2007\",\n  \"T2779700\"=\"internet_2008\",\n  \"T4494400\"=\"internet_2009\",\n  \"T6141400\"=\"internet_2010\",\n  \"T7635300\"=\"internet_2011\",\n  \"R1193900\"=\"agemon_1997\",\n  \"R2553400\"=\"agemon_1998\",\n  \"R3876200\"=\"agemon_1999\",\n  \"R5453600\"=\"agemon_2000\",\n  \"R7215900\"=\"agemon_2001\",\n  \"S1531300\"=\"agemon_2002\",\n  \"S2000900\"=\"agemon_2003\",\n  \"S3801000\"=\"agemon_2004\",\n  \"S5400900\"=\"agemon_2005\",\n  \"S7501100\"=\"agemon_2006\",\n  \"T0008400\"=\"agemon_2007\",\n  \"T2011000\"=\"agemon_2008\",\n  \"T3601400\"=\"agemon_2009\",\n  \"T5201300\"=\"agemon_2010\",\n  \"T6651200\"=\"agemon_2011\",\n  \"R1194100\"=\"ageyear_1997\",\n  \"R2553500\"=\"ageyear_1998\",\n  \"R3876300\"=\"ageyear_1999\",\n  \"R5453700\"=\"ageyear_2000\",\n  \"R7216000\"=\"ageyear_2001\",\n  \"S1531400\"=\"ageyear_2002\",\n  \"S2001000\"=\"ageyear_2003\",\n  \"S3801100\"=\"ageyear_2004\",\n  \"S5401000\"=\"ageyear_2005\",\n  \"S7501200\"=\"ageyear_2006\",\n  \"T0008500\"=\"ageyear_2007\",\n  \"T2011100\"=\"ageyear_2008\",\n  \"T3601500\"=\"ageyear_2009\",\n  \"T5201400\"=\"ageyear_2010\",\n  \"T6651300\"=\"ageyear_2011\",\n  \"R1235800\"=\"sample\",\n  \"S0919700\"=\"todo_2002\",\n  \"S6317100\"=\"todo_2005\",\n  \"T2782200\"=\"todo_2008\",\n  \"T7637800\"=\"todo_2011\",\n  \"R4893900\"=\"happy_2000\",\n  \"S0921100\"=\"happy_2002\",\n  \"S4682200\"=\"happy_2004\",\n  \"S8332600\"=\"happy_2006\",\n  \"T2782900\"=\"happy_2008\",\n  \"T6144000\"=\"happy_2010\",\n  \"R4893600\"=\"nervous_2000\",\n  \"S0920800\"=\"nervous_2002\",\n  \"S4681900\"=\"nervous_2004\",\n  \"S8332300\"=\"nervous_2006\",\n  \"T2782600\"=\"nervous_2008\",\n  \"T6143700\"=\"nervous_2010\",\n  \"R4893700\"=\"calm_2000\",\n  \"S0920900\"=\"calm_2002\",\n  \"S4682000\"=\"calm_2004\",\n  \"S8332400\"=\"calm_2006\",\n  \"T2782700\"=\"calm_2008\",\n  \"T6143800\"=\"calm_2010\",\n  \"R4894000\"=\"depressed_2000\",\n  \"S0921200\"=\"depressed_2002\",\n  \"S4682300\"=\"depressed_2004\",\n  \"S8332700\"=\"depressed_2006\",\n  \"T2783000\"=\"depressed_2008\",\n  \"T6144100\"=\"depressed_2010\",\n  \"R4893800\"=\"blue_2000\",\n  \"S0921000\"=\"blue_2002\",\n  \"S4682100\"=\"blue_2004\",\n  \"S8332500\"=\"blue_2006\",\n  \"T2782800\"=\"blue_2008\",\n  \"T6143900\"=\"blue_2010\",\n  \"R0552400\"=\"attendPR\",\n  \"R4893400\"=\"attend_2000\",\n  \"R6520100\"=\"attend_2001\",\n  \"S0919300\"=\"attend_2002\",\n  \"S2987800\"=\"attend_2003\",\n  \"S4681700\"=\"attend_2004\",\n  \"S6316700\"=\"attend_2005\",\n  \"S8331500\"=\"attend_2006\",\n  \"T0739400\"=\"attend_2007\",\n  \"T2781700\"=\"attend_2008\",\n  \"T4495000\"=\"attend_2009\",\n  \"T6143400\"=\"attend_2010\",\n  \"T7637300\"=\"attend_2011\",\n  \"S1225400\"=\"computer_2002\",\n  \"T1049900\"=\"computer_2007\",\n  \"T3145100\"=\"computer_2008\",\n  \"T4565400\"=\"computer_2009\",\n  \"T6209600\"=\"computer_2010\",\n  \"T7707000\"=\"computer_2011\",\n  \"S1225500\"=\"tv_2002\",\n  \"T1050000\"=\"tv_2007\",\n  \"T3145200\"=\"tv_2008\",\n  \"T4565500\"=\"tv_2009\",\n  \"T6209700\"=\"tv_2010\",\n  \"T7707100\"=\"faith_2011\",\n  \"T2782400\"=\"faith_2008\",\n  \"T7638000\"=\"bmonth\",\n  \"R0536401\"=\"bmonth\",\n  \"R0536402\"=\"byear\",\n  \"R1482600\"=\"race\",\n  \"R0536300\"=\"sex\",\n  \"R0000100\"=\"id\",\n  \"T2111500\"=\"bornagain_2008\",\n  \"T6759400\"=\"bornagain_2011\",\n  \"S0919600\"=\"decisions_2002\",\n  \"S6317000\"=\"decisions_2005\",\n  \"T2782100\"=\"decisions_2008\",\n  \"T7637700\"=\"decisions_2011\",\n  \"S0919500\"=\"obeyed_2002\",\n  \"S6316900\"=\"obeyed_2005\",\n  \"T2782000\"=\"obeyed_2008\",\n  \"T7637600\"=\"obeyed_2011\",\n  \"S5532800\"=\"relpref_2005\",\n  \"T2111400\"=\"relpref_2008\",\n  \"T6759300\"=\"relpref_2011\",\n  \"S0919400\"=\"values_2002\",\n  \"S6316800\"=\"values_2005\",\n  \"T2781900\"=\"values_2008\",\n  \"T7637500\"=\"values_2011\",\n  \"S0919800\"=\"pray_2002\",\n  \"S6317200\"=\"pray_2005\",\n  \"T2782300\"=\"pray_2008\",\n  \"T7637900\"=\"pray_2011\",\n  \"R0552300\"=\"relprefPR\",\n  \"R0552200\"=\"relraisedPR\"  \n))\n\n# negativelyPhrased<-c(\"todo_\",\"values_\")\n# negativelyYears<-c(\"2002\",\"2005\",\"2008\",\"2011\")\n# \n# for (i in negativelyPhrased){\n#   for(k in negativelyYears){\n# dsSource$paste0(i,k)=ifelse(( dsSource$paste0(i,k) %in% c(1)),0,ifelse(( dsSource$paste0(i,k) %in% c(0)),1,NA))\n# }\n# }\ndsLong$year <- as.integer(dsLong$year) #Convert to a number.\n# recode negativale worded question:  1 - more religious\ndsSource$todo_2002=ifelse((dsSource$todo_2002 %in% c(1)),0,ifelse((dsSource$todo_2002 %in% c(0)),1,NA))\ndsSource$todo_2005=ifelse((dsSource$todo_2005 %in% c(1)),0,ifelse((dsSource$todo_2005 %in% c(0)),1,NA))\ndsSource$todo_2008=ifelse((dsSource$todo_2008 %in% c(1)),0,ifelse((dsSource$todo_2008 %in% c(0)),1,NA))\ndsSource$todo_2011=ifelse((dsSource$todo_2011 %in% c(1)),0,ifelse((dsSource$todo_2011 %in% c(0)),1,NA))\n\ndsSource$values_2002=ifelse((dsSource$values_2002 %in% c(1)),0,ifelse((dsSource$values_2002 %in% c(0)),1,NA))\ndsSource$values_2005=ifelse((dsSource$values_2005 %in% c(1)),0,ifelse((dsSource$values_2005 %in% c(0)),1,NA))\ndsSource$values_2008=ifelse((dsSource$values_2008 %in% c(1)),0,ifelse((dsSource$values_2008 %in% c(0)),1,NA))\ndsSource$values_2011=ifelse((dsSource$values_2011 %in% c(1)),0,ifelse((dsSource$values_2011 %in% c(0)),1,NA))\n\n# Include only records with a valid birth year\ndsSource <- dsSource[dsSource$byear %in% 1980:1984, ]\n\n#Include only records with a valid ID\ndsSource <- dsSource[dsSource$id != \"V\", ]\ndsSource$id <- as.integer(dsSource$id)\n# remove all but one dataset\n#  rm(list=setdiff(ls(), \"dsSource\"))\n\n# Variables, which values that DON'T change with time - time invariant (TI) variables \nTIvars<-c(\"sample\", \"id\", \"sex\",\"race\", \"byear\", \"bmonth\", 'attendPR', \"relprefPR\", \"relraisedPR\")\n\n\n\n#################################\n## Preparing the common Long dataset\nds<-dsSource\n## id.vars declares MEASURED variables (as opposed to RESPONSE variable)\ndsLong <- reshape2::melt(ds, id.vars=TIvars)\n# create varaible \"year\" by stripping the automatic ending in TV variables' names\ndsLong$year<-str_sub(dsLong$variable,-4,-1) \n# the automatic ending in TV variables' names\ntimepattern<-c(\"_1997\", \"_1998\", \"_1999\", \"_2000\", \"_2001\", \"_2002\", \"_2003\", \"_2004\", \"_2005\", \"_2006\",\"_2007\", \"_2008\", \"_2009\", \"_2010\", \"_2011\")\n# Strip off the automatic ending\nfor (i in timepattern){\ndsLong$variable <- gsub(pattern=i, replacement=\"\", x=dsLong$variable) \n}\n# Convert to a number.\ndsLong$year <- as.integer(dsLong$year) \n# Remove illegal values\nillegal<-c(-5:-1,997,998,999)\ndsLong$value=ifelse(dsLong$value %in% illegal,NA,dsLong$value)\n# reorder for easier inspection\ndsLong<-dsLong[with(dsLong, order(id,variable)), ]\n# view the long data for one person\nprint(dsLong[dsLong$id==1,]) \n\n##############################\n## Create individual long datasets, one per TV variable\nTVvars<-unique(dsLong$variable)\nTVvars<-\"attend\"\n\ndsL_agemon<-subset(dsLong,subset=(dsLong$variable==\"agemon\"))\ndsL_agemon<-rename(dsL_agemon,replace=c(\"value\"=\"agemon\"))\ndsL_agemon$variable<-NULL\n\ndsL_attend<-subset(dsLong,subset=(dsLong$variable==\"attend\"))\ndsL_attend<-rename(dsL_attend,replace=c(\"value\"=\"attend\"))\ndsL_attend$variable<-NULL\n\ndsL_internet<-subset(dsLong,subset=(dsLong$variable==\"internet\"))\ndsL_internet<-rename(dsL_internet,replace=c(\"value\"=\"internet\"))\ndsL_internet$variable<-NULL\n\ndsL<-merge(x=dsL_agemon,y=dsL_attend,by=c(TIvars,\"year\"),all.x=TRUE)\ndsL<-arrange(dsL,id)\n\n\n",
    "created" : 1398049485601.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1954370709",
    "id" : "CCC1EFA4",
    "lastKnownWriteTime" : 1398136929,
    "path" : "~/GitHub/Longitudinal_Models_of_Religiosity_NLSY97/Documentation/ImportAndClean.R",
    "project_path" : "Documentation/ImportAndClean.R",
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_source"
}