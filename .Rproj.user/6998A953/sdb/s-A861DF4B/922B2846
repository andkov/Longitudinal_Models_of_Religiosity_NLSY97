{
    "contents" : "---\ntitle: \"lm() in mutate()\"\nauthor: \"Andriy Koval\"\ndate: \"Tuesday, June 24, 2014\"\noutput:\n  pdf_document:\n    toc: yes\n  html_document:\n    css: ~/GitHub/Longitudinal_Models_of_Religiosity_NLSY97/www/css/thesis.css\n    fig.retina: 2\n  word_document:\n    fig_height: 3\n    fig_width: 6.5\n---\n\n\n<!--  Set the working directory to the repository's base directory; this assumes the report is nested inside of only one directory.-->\n```{r c1, echo=F, message=F} \nrequire(knitr)\nopts_knit$set(root.dir='../../../')  #Don't combine this call with any other chunk -especially one that uses file paths.\n\n```\n\n```{r set_options, echo=F, message=F}\nrequire(knitr)\n# getwd()\nopts_chunk$set(\n  results='show', \n  message = TRUE,\n  comment = NA, \n  tidy = FALSE,\n#   fig.height = 4.8, \n#   fig.width = 6.5, \n#   out.width = \"800px\",\n  dev = \"png\",\n  fig.path = 'figure_rdm/',     \n#   dev = \"pdf\",\n  dpi = 400\n)\nechoChunks <- FALSE\nwarningChunks<- FALSE\noptions(width=120) #So the output is 50% wider than the default.\nread_chunk(\"./Models/Descriptives/Descriptives.R\") \n```\n\n```{r DeclareGlobals, echo=echoChunks, message=FALSE}\n# Defined\n# attcol8 # color palette for attendance\n# baseSize # base text size\n# colNA # color for the NA value in graphs\n\n```\n\n```{r LoadPackages, echo=echoChunks, message=F}\n```\n\n```{r LoadData, echo=echoChunks, message=T}\n# select only respondence in the cross-sectional sample\n\n```\n\nData for a single person\n```{r c2, echo=T,eval=TRUE, message=T}\nds<- dsL %>% dplyr::filter(id==1,year %in% c(2000:2011)) %>% dplyr::select(id,year,attend) %>%\n  mutate(time=year-2000)\nprint(ds)\n```\n\n```{r c3, echo=F}\n# ds <- read.table(header = TRUE, text =\"\n# obs  id year attend\n# 1  47 2000      4\n# 2  47 2001      5\n# 3  47 2002      6\n# 4  47 2003      7\n# 5  47 2004      6\n# 6  47 2005      5\n# 7  47 2006      4\n# 8  47 2007      3\n# 9  47 2008      2\n# 10 47 2009      1\n# 11 47 2010      2\n# 12 47 2011      3\n# \n# \")\n# ds<- ds %>% dplyr::mutate(time=year-2000)\n# print(ds)\n\n```\n\n\n```{r c4, echo=F}\nrequire(ggplot2)\np<-ggplot(ds, aes(x=time,y=attend, color=idF))\np<-p+ geom_line(color=\"purple\",linetype=2, size=.5)\n# p<-p+ geom_smooth(method=lm,stat=\"identity\", color=\"purple\")\np<-p+ geom_point(color=\"grey\", size=2)\np<-p+ scale_y_continuous(\"Church attendance\",\n                     limits=c(0, 8),\n                     breaks=c(1:8))\np<-p+ scale_x_continuous(\"Years since 2000\",\n                   limits=c(0,11),\n                   breaks=c(0:11))\n# annotations\np<-p+ labs(title=paste0(\"In the past year, how often have you attended a worship service?\"))\np<- p + guides(color=guide_legend) \n# themes\np <- p + ggplot2::theme_bw()\np <- p + ggplot2::theme_bw(base_size=baseSize)\np <- p + ggplot2::theme(title=ggplot2::element_text(colour=\"gray20\",size = 12)) \np <- p + ggplot2::theme(axis.text=ggplot2::element_text(colour=\"gray40\"))\np <- p + ggplot2::theme(axis.title=ggplot2::element_text(colour=\"gray40\"))\np <- p + ggplot2::theme(panel.border = ggplot2::element_rect(colour=\"gray80\"))\np <- p + ggplot2::theme(axis.ticks.length = grid::unit(0, \"cm\"))\np\n```\n\n\nadd a straight line to represent possible predition line, in this case a straight line\n```{r c5}\nlinear<- predict(lm(attend ~ time, ds))\nds<- ds %>% dplyr::mutate(linear=linear)\nprint(ds)\np<-p+ geom_line(aes(y=linear),color=\"red\", size=.5)\np\n```\nOr adding the curvarture the  quadratic term\n```{r c6}\nquadratic<- predict(lm(attend ~ poly(time,2),ds))\nds<- ds %>% mutate(quadratic=quadratic)\nprint(ds)\np<-p+ geom_line(aes(y=quadratic),color=\"blue\", size=.5)\n p\n# p<-p+ geom_line(aes(y=cubic),color=\"green\", size=.5)\n```\nor the cubic term\n```{r c7}\ncubic<- predict(lm(attend ~ poly(time,3),ds))\nds<- ds %>% mutate( cubic=cubic)\nprint(ds)\np<-p+ geom_line(aes(y=cubic),color=\"green\", size=.5)\np\n```\n\n\n\n\n",
    "created" : 1404535676398.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3738053707",
    "id" : "922B2846",
    "lastKnownWriteTime" : 1404423696,
    "path" : "~/GitHub/Longitudinal_Models_of_Religiosity_NLSY97/Vignettes/Questions/lm_in_mutate/lm_in_mutate.Rmd",
    "project_path" : "Vignettes/Questions/lm_in_mutate/lm_in_mutate.Rmd",
    "properties" : {
        "tempName" : "Untitled2"
    },
    "source_on_save" : false,
    "type" : "r_markdown"
}