{
    "contents" : "---\ntitle: \"LCM\"\noutput:\n  html_document:\n    css: ~/GitHub/Longitudinal_Models_of_Religiosity_NLSY97/www/css/thesis.css\n    fig.retina: 2\n    fig_width: 8\n    toc: yes\n  md_document:\n    toc: yes\n    toc_depth: 3\n  pdf_document:\n    fig_crop: no\n    fig_width: 8\n    highlight: haddock\n    latex_engine: xelatex\n    number_sections: yes\n    toc: yes\n    toc_depth: 3\n  word_document:\n    fig_width: 6.5\nmainfont: Calibri\n---\n\n\n\n\n<!--  Set the working directory to the repository's base directory; this assumes the report is nested inside of only one directory.-->\n```{r, echo=F, message=F} \nrequire(knitr)\nopts_knit$set(root.dir='../../')  #Don't combine this call with any other chunk -especially one that uses file paths.\n\n```\n\n```{r set_options, echo=F, message=F}\nrequire(knitr)\n# getwd()\nopts_chunk$set(\n  results='show', \n  message = TRUE,\n  comment = NA, \n  tidy = FALSE,\n#   fig.height = 4.8, \n#   fig.width = 6.5, \n#   out.width = NULL,\n  fig.path = 'figure_rmd/',     \n  dev = \"png\",\n  dpi = 400\n)\nechoChunks <- FALSE\nwarningChunks<- FALSE\noptions(width=120) #So the output is 50% wider than the default.\nread_chunk(\"./Models/LCM/LCM.R\") # the file to which knitr calls for the chunks\n```\n\n```{r DeclareGlobals, echo=echoChunks, message=FALSE}\naesDefs\n```\n\n```{r LoadPackages, echo=echoChunks, message=F}\n```\n\n```{r LoadData, echo=echoChunks, message=T}\n# select only respondence in the cross-sectional sample\n\n```\n\n\n\nAnalyzing a sequence of multilevel latent curve models of church attendance in NLSY97.\n\n# Data\n\nThe preparation of this dataset is described in the report [Derive_dsL_from_Extract][derive]. For the scales and factor levels, refer to [Metrics][metrics] report, which relies on the script  [LabelingFactorLevels.R][labels] sourced at the end of [Derive_dsL_from_Extract][3].\n\nA basic LCM in this sequence relies on four variables from the **dsL** dataset: identifyer (**id**), birth year which is also used as cohort indicator (**byear**), wave of measurement (**year**), and the variable of interest - worship attendance (**attend**). \n```{r, echo=echoChunks, message=F}\nrequire(dplyr)\nds<- dsL %>% select(id, byear, year, attend) %>% \n  filter(year %in% c(2000:2011)) %>%\n  filter (id %in% c(1))\nds\n```\n\nThe focal variable of interest is **attend**, an item measuring church attendance in the current year. Although it was recorded on an ordinal scale, the integers used to record the response (1 through 8) are treated as measurements on the continuous scale when fitted in these statistical models. For elaboraton on metrics of church attendance and time, see [Attendance][attend] report.\n\n\nNew variable **timec** is created, containing the values of **year**, centered at 2000. The numbers on the horizontal axes represent years passed since 2000. In addition, time effects are added, encoded as  weights of the Lambda matrix. Notice that equality of **timec** and **linear** is coincidental. \n```{r, echo=echoChunks, message=F}\nds<- dsL %>% select(id, byear, year, attend) %>% \n  filter(year %in% c(2000:2011)) %>%\n  mutate(timec=year-2000, linear=timec, quadratic=timec^2, cubic=timec^3) %>%\n  filter (id %in% c(1))\nds\n```\n\nNLSY97 has the data on church attendance for 12 years (as of July 2014), from 2000 to 2011. LCM models trajectories of individuals. The following graph maps the data from the previous example (id = 837):  \n## model 00\n\n\\[{y_{ti}} = {\\beta _0} + {\\varepsilon _{ti}}\\]  \n\n```{r m0,echo=echoChunks, message=F }\n\n# create model object\nds<- dsL %>% dplyr::filter(id %in% c(1:200),year %in% c(2000:2011)) %>% \n  dplyr::mutate(timec=year-2000, timec2= timec^2, timec3= timec^3, \n                agec= round( (agemon/12),0)-16) %>% \n  dplyr::select(id,year,attend, timec,timec2, timec3, agec)\n########################################################\n\n\nmodel<- m0\n# getting the model prediction and residuals\ndsP<-data.frame(model@frame )\ndsP$Resid<- lme4:::residuals.merMod(model)\ndsP$YHat<- fitted (model)\ndsm0<- plyr::join(ds,dsP,by=c(\"id\"))\nhead(dsm0)\n\nmodel<- m5\n# getting the model prediction and residuals\ndsP<-data.frame(model@frame )\ndsP$Resid<- lme4:::residuals.merMod(model)\ndsP$YHat<- fitted (model)\nhead(dsP,20)\n# ds<- plyr::join(ds,dsP,by=c(\"id\"))\n\n\nmodel<- m10\n# getting the model prediction and residuals\ndsp<-data.frame(model@frame)\ndsp$yHat<- predict(model)\ndsp$resid<- lme4:::residuals.merMod(model)\ncoefs <- fixef(model)\ndsp$yPar<-(\n  (coefs[\"(Intercept)\"])         +(coefs[\"agec\"]*dsp$agec)\n  +(coefs[\"timec\"]*dsp$timec)    +(coefs[\"agec:timec\"]*dsp$agec*dsp$timec)\n  +(coefs[\"timec2\"]*dsp$timec2)  +(coefs[\"agec:timec2\"]*dsp$agec*dsp$timec2)\n  +(coefs[\"timec3\"]*dsp$timec3)  +(coefs[\"agec:timec3\"]*dsp$agec*dsp$timec3)\n)\nhead(dsp,20)\n# \nlme4:::summary.merMod(model)\n# extract fixed effects matrix\nFE<- data.frame(getME(model, \"X\"))\n\n# extract random effect matrix\nRE<- getME(model,\"mu\")\na<- data.frame(RE)\n\nFE<- fixef(model)\n\nmodel@theta\n\n# the formula used in estimating the model\nmodel@call\n# List of fixed effect estimates\nmodel@beta\nfixef(model)\n# random effect estimates\nranef(model)\ngetME(model, \"X\")\n# not sure what\nmodel@theta\nmodel@pp$theta\n\n\ncoefs(model)\n# ds<- dplyr::left_join(ds,dsP[\"id\", \"YHat\"],by= c(\"id\",\"timec\"),copy=FALSE)\n# dsp <- plyr::join(x=ds, y=dsPredict, by=c(\"id\", \"timec\")) \n\n\n```\n\n\n\n\n\\[\\begin{array}{*{20}{c}}\n\\begin{array}{l}\n{y_{ij}} = {\\beta _{0j}} + {\\beta _{1j}}{X_{1j}} + {\\beta _{2j}}{X_{2j}}^2 + {\\beta _{3j}}{X_{3j}}^3 + {\\varepsilon _{ij}}\\\\\n{\\beta _{0j}} = {\\gamma _{00}} + {\\gamma _{01}}{W_1} + {u_{0j}}\\\\\n{\\beta _{1j}} = {\\gamma _{10}} + {u_{1j}}\\\\\n{\\beta _{2j}} = {\\gamma _{20}} + {\\gamma _{21}}{Z_1} + {u_{2j}}\\\\\n{\\beta _{3j}} = {\\gamma _{30}}\n\\end{array}&{}&{}&{}\n\\end{array}\\]\n\n\n\n\n```{r child, child = '../Descriptives/Citations.Rmd'}\n\n```\n\n\n",
    "created" : 1404431241135.000,
    "dirty" : true,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3939233575",
    "id" : "2FBAD5B6",
    "lastKnownWriteTime" : 1404456878,
    "path" : "~/GitHub/Longitudinal_Models_of_Religiosity_NLSY97/Models/LCM/LCM.Rmd",
    "project_path" : "Models/LCM/LCM.Rmd",
    "properties" : {
        "tempName" : "Untitled2"
    },
    "source_on_save" : false,
    "type" : "r_markdown"
}